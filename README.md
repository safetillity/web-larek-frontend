# Проектная работа "Веб-ларек"

## Стек

HTML, SCSS, TS, Webpack

## Структура проекта

- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом

## Важные файлы

- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды:

```bash
npm install
npm run start
или

bash



yarn
yarn start
Сборка
bash



npm run build
или

bash



yarn build
Архитектура проекта
Проект "Веб-ларек" основан на архитектурном паттерне Model-View-Presenter (MVP), который разделяет приложение на три основные компоненты:

Model: Отвечает за управление данными, бизнес-логикой и правилами приложения.
View: Отображает данные пользователю и отправляет команды пользователю в Presenter. В эту зону ответственности входит отрисовка и обновление UI.
Presenter: Связывает Model и View, обрабатывая данные и обновляя представление. В роли Presenter выступает EvenEmitter . Процессы приложения реализованы через обработку событий. Компоненты используют события для взаимодействия с пользователем, что позволяет динамически обновлять интерфейс.
Взаимодействие частей

Пользователь взаимодействует с View (нажимает кнопку).
Presenter обрабатывает событие и запрашивает данные у Model.
Model передает данные Presenter.
Presenter обновляет View.


Основные классы

Слой Model

1. Класс Api
Класс Api является основой для взаимодействия с API. Он предоставляет методы для выполнения HTTP-запросов и обработки их ответов.

Конструктор:

constructor(baseUrl: string, options: RequestInit = {})
Параметры:

baseUrl: string — базовый URL для API запросов.
options: RequestInit — настройки запроса, такие как заголовки.
Методы:

get(uri: string): Promise<object> — выполняет GET запрос к указанному URI.
post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object> — выполняет POST запрос с данными.


2. Класс ApiModel
Класс ApiModel является наследником класса Api и реализует интерфейс IApiModel, добавляя специфические методы для работы с продуктами.
поле :  readonly cdn: string указывающая на базовый URL для контентной доставки
Конструктор:
constructor(cdn: string, serviceBaseUrl: string, requestOptions?: RequestInit): Конструктор принимает три параметра: cdn (строка, указывающая на базовый URL для контентной доставки), serviceBaseUrl (строка, указывающая на базовый URL API сервиса) и requestOptions (опциональный параметр для настройки запросов).
Методы:
fetchProductDetails(productId: string): Promise<ICard>: Метод получает информацию о конкретном продукте по его идентификатору productId. Возвращает промис, который разрешается в объект ICard, дополненный URL изображения, формируемым на основе cdn.

fetchAllProducts(): Promise<ICard[]>: Метод получает список всех продуктов. Возвращает промис, который разрешается в массив объектов ICard, каждый из которых также содержит URL изображения, сформированный на основе cdn.

placeOrder(orderData: IOrderData): Promise<IOrderResults>: Метод размещает заказ с использованием данных orderData. Возвращает промис, который разрешается в объект IOrderResults, содержащий информацию о результате размещения заказа.


3. Класс appData
Класс AppData управляет данными приложения, включая корзину товаров, каталог товаров и информацию о заказе. Он также отвечает за валидацию данных заказа и взаимодействие с событиями в приложении.

Поля:
basket: ICard[] — массив корзины, содержащий товары, добавленные пользователем.
catalog: ICard[] — массив товаров каталога, представляющий доступные для покупки товары.
order: IOrderData — объект с информацией о заказе, включая контактные данные, способ оплаты и список товаров.
preview: string | null — строка для хранения идентификатора товара, выбранного для предварительного просмотра.
formErrors: ValidationErrors — объект для хранения ошибок валидации формы заказа.
Методы:
createOrderPayload(): IOrderData & { total: number; items: string[] } — создает и возвращает объект заказа с информацией о товарах и общей стоимостью.
initializeOrder(): IOrderData — инициализирует объект заказа с пустыми значениями.
updateCatalog(newItems: ICard[]): void — обновляет каталог товаров, добавляя новые элементы.
setPreview(item: ICard): void — устанавливает предварительный просмотр выбранного товара.
toggleBasketItem(card: ICard): void — добавляет или удаляет товар из корзины.
isInBasket(card: ICard): boolean — проверяет, находится ли товар в корзине
addItemToBasket(item: ICard): void — добавляет товар в корзину.
removeItemFromBasket(card: ICard): void — удаляет товар из корзины.
getCardIndex(item: ICard): number — возвращает индекс товара в корзине (начиная с 1).
resetBasket(): void — очищает корзину и уведомляет об изменениях.
resetOrder(): void — сбрасывает данные заказа и уведомляет об изменениях.
setOrderFromBasket(): void — устанавливает данные заказа на основе содержимого корзины.
getBasketTotal(): number — вычисляет общую стоимость товаров в корзине.
updateOrderField<K extends keyof TOrderFormData>(field: K, value: string): void — обновляет указанное поле в объекте заказа и запускает валидацию.
validateOrder(): void — выполняет валидацию данных заказа и обновляет объект ошибок.
clearOrder(): void — очищает данные заказа и уведомляет об изменениях.

Слой Presenter
4. Класс EventEmitter
Класс EventEmitter реализует систему событий и подписок.

Методы:
on<T>(event: EventName, callback: (data: T) => void): void — подписывает на событие.
off(event: EventName, callback: Subscriber): void — отписывает от события.
emit<T>(eventName: string, data?: T): void — инициирует событие.
trigger<T>(event: string, context?: Partial<T>): (data: T) => void — создает триггер для событий.

Слой View

5. Класс Component
Класс абстрактный Component управляет отображением и состоянием элементов интерфейса.

Конструктор:
protected constructor(protected readonly container: HTMLElement): Конструктор принимает один параметр container (HTMLElement), который представляет собой контейнер для компонентов, управляемых этим классом.
Методы:
updateClass(element: HTMLElement, className: string, add: boolean): Метод добавляет или удаляет класс className у элемента element в зависимости от значения параметра add.

updateText(target: HTMLElement, content: unknown): void: Метод обновляет текстовое содержимое элемента target, преобразуя переданное значение content в строку.

setElementState(target: HTMLElement, isDisabled: boolean): void: Метод устанавливает состояние элемента target как отключенное или активное в зависимости от значения isDisabled.

hideElement(target: HTMLElement): void: Метод скрывает элемент target, устанавливая его стиль отображения в 'none'.

showElement(target: HTMLElement): void: Метод делает элемент target видимым, сбрасывая стиль отображения.

updateImage(imageElement: HTMLImageElement, source: string, alternativeText?: string): void: Метод обновляет источник изображения imageElement и, при наличии, устанавливает альтернативный текст alternativeText.

render(properties?: Partial<T>): HTMLElement: Метод рендерит компонент, обновляя его свойства на основе переданных данных properties, если они указаны, и возвращает контейнер this.container.


6. Класс Basket
Класс Basket управляет отображением и состоянием корзины покупок в интерфейсе.

Поля:
protected itemList: HTMLElement: Элемент, представляющий список товаров в корзине. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .basket__list внутри контейнера.

protected totalAmount: HTMLElement: Элемент, отвечающий за отображение общей суммы товаров в корзине. Инициализируется в конструкторе с помощью метода querySelector, который ищет элемент с классом .basket__price.

protected actionButton: HTMLElement: Элемент кнопки для оформления заказа. Инициализируется в конструкторе с помощью метода querySelector, который ищет элемент с классом .basket__button.

Конструктор:
constructor(container: HTMLElement, protected events: IEvents): Конструктор принимает два параметра: container (HTMLElement), представляющий контейнер для корзины, и events (интерфейс IEvents), который используется для обработки событий. Внутри конструктора инициализируются элементы: itemList, totalAmount и actionButton. Также вызываются методы setupActionButton для настройки обработчика событий на кнопке и clearBasket для очистки корзины.
Методы:
private setupActionButton(): void: Приватный метод, который устанавливает обработчик события клика на кнопке actionButton. При нажатии на кнопку вызывается событие order:open.

set items(items: HTMLElement[]): Сеттер для свойства items, который принимает массив элементов HTMLElement. Если массив не пустой, он заменяет содержимое itemList на переданные элементы и активирует кнопку. Если массив пустой, вызывается метод displayEmptyMessage.

private displayEmptyMessage(): void: Приватный метод, который отображает сообщение о том, что товары еще не добавлены в корзину. Он также отключает кнопку actionButton.

public clearBasket(): void: Публичный метод, который очищает корзину, устанавливая items в пустой массив и вызывая метод displayEmptyMessage.

set total(total: number): Сеттер для свойства total, который принимает число total и обновляет текстовое содержимое элемента totalAmount, отображая общую сумму .
7. Класс Card
Класс Card представляет собой компонент карточки товара, который отображает информацию о продукте, включая его название, изображение, цену, описание и категорию. Он также предоставляет возможность обрабатывать события, связанные с действием на карточке, например, нажатие кнопки.

Поля:
protected titleElement: HTMLElement — элемент, представляющий заголовок (название) товара. Инициализируется в конструкторе.
protected priceLabel: HTMLSpanElement — элемент, отображающий цену товара. Инициализируется в конструкторе.
protected imageElement: HTMLImageElement | null — элемент изображения товара. Инициализируется в конструкторе.
protected actionButton: HTMLButtonElement | null — кнопка действия (например, "Добавить в корзину"). Инициализируется в конструкторе.
protected categoryLabel: HTMLSpanElement | null — элемент, отображающий категорию товара. Инициализируется в конструкторе.
protected descriptionElement: HTMLElement | null — элемент, отображающий описание товара. Инициализируется в конструкторе.
protected indexElement: HTMLElement — элемент, отображающий индекс товара в корзине. Инициализируется в конструкторе, если товар находится в корзине.
protected removeButton: HTMLButtonElement — кнопка для удаления товара из корзины. Инициализируется в конструкторе, если товар находится в корзине.
Конструктор:
constructor(container: HTMLElement, handlers?: ICardActions, appData?: AppData, isInBasket = false) — конструктор принимает три параметра:
container (HTMLElement), представляющий контейнер для карточки,
handlers (интерфейс ICardActions), который содержит обработчики событий,
appData (опционально), экземпляр класса AppData,
isInBasket (по умолчанию false), указывающий, находится ли товар в корзине.
Внутри конструктора инициализируются элементы с помощью методов и связываются обработчики событий через методы bindEventHandlers или bindRemoveButtonEvent, в зависимости от состояния товара.
Методы:
private bindEventHandlers(handlers?: ICardActions): void — приватный метод, который связывает обработчик события клика на кнопке действия, если он предоставлен.

private bindRemoveButtonEvent(handlers?: ICardActions): void — приватный метод, который связывает обработчик события клика на кнопке удаления, если он предоставлен.

set button(text: string) — сеттер для текста кнопки действия, который обновляет текст кнопки.

updateButtonState({ text, disabled }: { text: string; disabled: boolean }): void
Метод обновляет текст кнопки действия и её состояние (активная или отключенная) в зависимости от переданных параметров.


set id(id: string) — сеттер для идентификатора продукта, который сохраняет значение в атрибуте data-id контейнера.

set title(title: string) — сеттер для названия товара, который обновляет текст заголовка.

set description(description: string) — сеттер для описания товара, который обновляет текст описания.

set price(price: number | null) — сеттер для цены товара, который форматирует и обновляет текст цены. Если цена равна null, отображает сообщение "Бесценно".

set image(src: string) — сеттер для изображения товара, который обновляет источник изображения.

set category(category: string) — сеттер для категории товара, который обновляет текст категории и добавляет класс, если категория известна.

set index(index: number) — сеттер для индекса товара, который обновляет текст индекса в корзине.


8. Класс Modal
Класс Modal представляет собой компонент модального окна, который управляет отображением контента и взаимодействием с пользователем. Он позволяет открывать и закрывать модальное окно, а также обрабатывать события, связанные с его взаимодействием.

Поля:
protected closeButton: HTMLButtonElement: Элемент кнопки закрытия модального окна. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .modal__close внутри контейнера.

protected contentElement: HTMLElement: Элемент, представляющий содержимое модального окна. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .modal__content внутри контейнера.

Конструктор:
constructor(container: HTMLElement, protected events: IEvents): Конструктор принимает два параметра: container (HTMLElement), представляющий контейнер для модального окна, и events (интерфейс IEvents), который используется для обработки событий. Внутри конструктора инициализируются элементы closeButton и contentElement, а также вызывается метод attachEventListeners для привязки обработчиков событий.
Методы:
private attachEventListeners(): void: Приватный метод, который устанавливает обработчики событий для элементов модального окна. Он связывает клики на кнопке закрытия и на самом контейнере с методом close, предотвращает всплытие событий клика на элементе contentElement, а также добавляет обработчик нажатия клавиш для закрытия модального окна при нажатии клавиши Escape.

private handleKeyDown(event: KeyboardEvent): void: Приватный метод, который обрабатывает нажатия клавиш. Если нажата клавиша Escape, вызывается метод close.

set content(value: HTMLElement | null): Сеттер для содержимого модального окна. Если переданное значение равно null, очищается содержимое contentElement. В противном случае содержимое заменяется на переданный элемент.

open(): Метод для открытия модального окна. Он добавляет класс modal_active к контейнеру и вызывает событие modal:opened.

close(): Метод для закрытия модального окна. Он удаляет класс modal_active из контейнера, очищает содержимое модального окна и вызывает событие modal:closed.

render(data: IModal): HTMLElement: Метод для рендеринга модального окна с заданными данными. Вызывает метод render родительского класса и открывает модальное окно. Возвращает контейнер модального окна.

9.Класс BaseForm
Класс BaseForm представляет собой базовый компонент формы, который управляет состоянием формы, обработкой ввода пользователя и валидацией. Он предоставляет функциональность для обработки событий, связанных с изменением полей формы и отправкой данных.

Поля:
protected submitButton: HTMLButtonElement: Элемент кнопки отправки формы. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент кнопки с типом submit внутри формы.

protected errorContainer: HTMLElement: Элемент, предназначенный для отображения сообщений об ошибках валидации формы. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .form__errors внутри формы.

Конструктор:
constructor(protected formElement: HTMLFormElement, protected events: IEvents): Конструктор принимает два параметра: formElement (HTMLFormElement), представляющий саму форму, и events (интерфейс IEvents), который используется для обработки событий. Внутри конструктора инициализируются элементы submitButton и errorContainer. Также устанавливаются обработчики событий для отслеживания ввода в поля формы и для обработки отправки формы.
Методы:
protected onFieldChange(field: keyof T, value: string): Приватный метод, который вызывается при изменении значения поля формы. Он генерирует событие, указывающее на изменение конкретного поля, передавая его имя и новое значение.

set isValid(isValid: boolean): Сеттер для свойства isValid, который включает или отключает кнопку отправки формы в зависимости от переданного значения. Если форма валидна, кнопка будет активна; если нет — отключена.

set errorMessage(message: string): Сеттер для отображения сообщения об ошибке. Он обновляет текст в элементе errorContainer с помощью метода updateText.

resetForm(): Метод для сброса формы, который вызывает метод reset на элементе формы, очищая все поля.

renderForm(state: Partial<T> & IBaseForm): Метод для рендеринга формы с заданным состоянием. Он принимает объект состояния, содержащий информацию о валидности, ошибках и полях формы. Метод вызывает render родительского класса и обновляет поля формы на основе переданных данных, используя Object.assign.


10.Класс PaymentForm
Класс PaymentForm представляет собой компонент формы оплаты, который управляет вводом данных о способе оплаты и адресе доставки. Он расширяет базовый класс BaseForm и предоставляет функциональность для выбора способа оплаты (наличными или картой) и управления состоянием кнопок.

Поля:
addressInput: HTMLInputElement — элемент ввода для адреса доставки. Инициализируется в конструкторе.
cashButton: HTMLButtonElement — кнопка, представляющая способ оплаты наличными. Инициализируется в конструкторе.
onlineButton: HTMLButtonElement — кнопка, представляющая способ оплаты картой. Инициализируется в конструкторе.
Конструктор:
constructor(formElement: HTMLFormElement, events: IEvents) — конструктор принимает два параметра:
formElement (HTMLFormElement), представляющий элемент формы,
events (интерфейс IEvents), который используется для обработки событий.
Внутри конструктора инициализируются элементы формы с помощью метода ensureElement, а также связываются обработчики событий для кнопок оплаты. При нажатии на кнопки отправляется событие order:changed, которое содержит информацию о выбранном способе оплаты.
Методы:
highlightPaymentButton(button: HTMLElement) — метод, который выделяет кнопку оплаты, переданную в качестве параметра, и очищает выделение у других кнопок.

clearPaymentHighlight() — метод, который очищает выделение у кнопок оплаты, убирая класс button_alt-active с обеих кнопок.

setPaymentState(payment: string): void
Метод устанавливает визуальное состояние (выделение) для кнопки способа оплаты в зависимости от выбранного метода.

updatePaymentButtons(payment: string): void
Метод обновляет визуальное состояние кнопок способов оплаты, проверяя наличие выбранного метода.

set address(value: string) — сеттер для адреса доставки, который устанавливает значение в элемент ввода адреса.


11.Класс ContactForm
Класс ContactForm представляет собой компонент формы для ввода контактной информации пользователя, включая адрес электронной почты и номер телефона. Он расширяет базовый класс BaseForm и предоставляет функциональность для управления вводом контактных данных.

Поля:
protected emailInput: HTMLInputElement — элемент ввода для адреса электронной почты. Инициализируется в конструкторе.
protected phoneInput: HTMLInputElement — элемент ввода для номера телефона. Инициализируется в конструкторе.
Конструктор:
constructor(formElement: HTMLFormElement, events: IEvents) — конструктор принимает два параметра:
formElement (HTMLFormElement), представляющий элемент формы,
events (интерфейс IEvents), который используется для обработки событий.
Внутри конструктора инициализируются элементы формы для ввода электронной почты и номера телефона с использованием свойства elements.namedItem для доступа к соответствующим элементам.
Методы:
set email(value: string) — сеттер для адреса электронной почты, который устанавливает значение в элемент ввода электронной почты.

set phone(value: string) — сеттер для номера телефона, который устанавливает значение в элемент ввода номера телефона.


12. Класс Page
Класс Page
Класс Page представляет собой компонент страницы, который управляет различными элементами интерфейса, такими как счетчик товаров в корзине, галерея и главный контейнер страницы. Он также обрабатывает события, связанные с взаимодействием пользователя с элементами страницы, такими как открытие корзины.

Поля:
protected basketCounterElement: HTMLElement: Элемент, отображающий количество товаров в корзине. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .header__basket-counter.

protected galleryElement: HTMLElement: Элемент галереи, в который будут помещаться товары или изображения. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .gallery.

protected mainWrapper: HTMLElement: Основной контейнер страницы, который может быть заблокирован или разблокирован в зависимости от состояния. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .page__wrapper.

protected headerBasketElement: HTMLElement: Элемент заголовка, представляющий корзину. Инициализируется в конструкторе с помощью функции ensureElement, которая находит элемент с классом .header__basket.

Конструктор:
constructor(container: HTMLElement, protected events: IEvents): Конструктор принимает два параметра: container (HTMLElement), представляющий контейнер страницы, и events (интерфейс IEvents), который используется для обработки событий. Внутри конструктора инициализируются элементы basketCounterElement, galleryElement, mainWrapper и headerBasketElement. Также устанавливается обработчик события для клика на элементе headerBasketElement, который генерирует событие basket:show, сигнализируя о том, что корзина должна быть показана.
Методы:
private initEventListeners(): void: Приватный метод, который инициализирует обработчики событий. В данном случае он добавляет обработчик клика для элемента headerBasketElement, который вызывает метод handleBasketClick.

private handleBasketClick(): void: Приватный метод, который обрабатывает клики на элементе корзины. Он генерирует событие basket:show, уведомляя другие части приложения о необходимости показать корзину.

public set counter(value: number): Сеттер для обновления счетчика товаров в корзине. Он обновляет текст в элементе basketCounterElement, преобразуя переданное значение в строку.

public set catalog(items: HTMLElement[]): Сеттер для обновления содержимого галереи. Он заменяет дочерние элементы в galleryElement на переданные элементы, тем самым обновляя галерею.

public set locked(value: boolean): Сеттер для блокировки или разблокировки основного контейнера страницы. Он добавляет или удаляет класс page__wrapper_locked в зависимости от переданного значения, что может использоваться для управления доступом к элементам страницы.

13. Класс Success
об успешном завершении операции, например, успешной оплаты заказа. Он предоставляет пользователю возможность закрыть уведомление и отображает информацию о сумме, которая была списана.

Поля:
protected closeButton: HTMLElement: Элемент кнопки закрытия уведомления. Инициализируется в методе initializeElements, который находит элемент с классом .order-success__close внутри контейнера.

protected messageElement: HTMLElement: Элемент, отображающий сообщение об успешной операции. Инициализируется в методе initializeElements, который находит элемент с классом .order-success__description внутри контейнера.

Конструктор:
constructor(container: HTMLElement, actions: ISuccessActions): Конструктор принимает два параметра: container (HTMLElement), представляющий контейнер для компонента, и actions (интерфейс ISuccessActions), который содержит действия, связанные с успешным завершением операции. Внутри конструктора вызываются методы initializeElements для инициализации элементов и bindEventHandlers для связывания обработчиков событий.
Методы:
private initializeElements(): void: Приватный метод, который инициализирует элементы closeButton и messageElement, используя функцию ensureElement для поиска соответствующих элементов в контейнере.

private bindEventHandlers(actions?: ISuccessActions): void: Приватный метод, который связывает обработчики событий с элементами компонента. Если в actions передан метод onClick, он добавляет обработчик клика на кнопку closeButton, который будет вызывать это действие при нажатии.

set total(value: string): Сеттер для обновления текста в элементе messageElement. Он устанавливает текстовое содержимое, информируя пользователя о том, какая сумма была списана, формируя строку вида Списано {value} синапсов.
```
